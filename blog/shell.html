<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta http-equiv="X-UA-Compatible" content="IE=7" />
<meta name="keywords" content="linux,python,vim,blog,waikeung,waikeungshen,博客,编程,代码,算法,数据结构" />
<meta name="description" content="" />
<link rel="Stylesheet" type="text/css" href="../style.css">
<link rel="Stylesheet" type="text/css" href="../article.css">
<title>Linux Shell</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" src="scripts/shCore.js"></script>
<script type="text/javascript" src="scripts/shBrushBash.js"></script>
<script type="text/javascript" src="scripts/shBrushCpp.js"></script>
<script type="text/javascript" src="scripts/shBrushCss.js"></script>
<script type="text/javascript" src="scripts/shBrushPython.js"></script>
<script type="text/javascript" src="scripts/shBrushPhp.js"></script>
<script type="text/javascript" src="scripts/shBrushSql.js"></script>
<script type="text/javascript" src="scripts/shBrushJava.js"></script>
<link type="text/css" rel="stylesheet" href="styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="styles/shThemeDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<div id="header">
    <h1><a href="../index.html">WaikeungShen'Blog</a></h1>
</div>
<div id="article">

<h1 id="toc_1">Linux Shell</h1>
<div class="toc">
<ul>
<li><a href="#toc_1">Linux Shell</a>
<ul>
<li><a href="#toc_1.1">What's Shell</a>
<ul>
<li><a href="#toc_1.1.1">变量(Variable)</a>
<li><a href="#toc_1.1.2">Shell中的特殊符号</a>
<li><a href="#toc_1.1.3">基本命令</a>
</ul>
<li><a href="#toc_1.2">Shell 脚本基础</a>
<ul>
<li><a href="#toc_1.2.1">编写基本的脚本</a>
<ul>
<li><a href="#toc_1.2.1.1">环境变量与用户变量</a>
<li><a href="#toc_1.2.1.2">数学运算</a>
<li><a href="#toc_1.2.1.3">退出脚本</a>
</ul>
<li><a href="#toc_1.2.2">结构化命令</a>
<ul>
<li><a href="#toc_1.2.2.1">if-then</a>
<li><a href="#toc_1.2.2.2">test</a>
<li><a href="#toc_1.2.2.3">for</a>
<li><a href="#toc_1.2.2.4">while</a>
<li><a href="#toc_1.2.2.5">until</a>
<li><a href="#toc_1.2.2.6">break,continue</a>
</ul>
<li><a href="#toc_1.2.3">输入输出</a>
<ul>
<li><a href="#toc_1.2.3.1">重定向输入输出</a>
<li><a href="#toc_1.2.3.2">管道</a>
</ul>
<li><a href="#toc_1.2.4">函数</a>
<li><a href="#toc_1.2.5">控制脚本</a>
</ul>
<li><a href="#toc_1.3">一些需要注意的地方</a>
</ul>
</ul>
</div>
<h2 id="toc_1.1">What's Shell</h2>
<p>
Shell 就是系统内核与用户交互时的中间介质，shell是系统的一个工具，用户直接面对的是shell而不是系统内核。用户把命令告诉shell，然后shell再把命令传递给系统的内核，内核再去支配计算机的硬件进行各种操作。
</p>

<p>
我所采用的是ubuntu也是绝大多数系统默认的的shell，叫做bash。
</p>

<ul>
<li>
记录历史命令

<li>
指令和文件补全
<br />  按<code>tab</code>键试试。

<li>
别名
<br />  <code>alias</code>与<code>unalias</code>。

<li>
通配符
<br />  在bash中，<code>*</code>匹配零个或多个字符，<code>?</code>匹配一个字符。

<li>
输入输出重定向
<br />  输入重定向<code>&lt;</code>,输出重定向<code>&gt;</code>,错误输出重定向<code>2&gt;</code>,追加重定向<code>&gt;&gt;</code>

<li>
管道
<br />  管道符<code>|</code>，把前面的输出丢给后面的输入。

<li>
作业控制
<br />  当运行一个进程时，可以用<code>ctrl+z</code>使它暂停，<code>fg</code>命令恢复它，<code>bg</code>使它后台运行，<code>ctrl+c</code>终止进程。

</ul>
    
<h3 id="toc_1.1.1">变量(Variable)</h3>
<ul>
<li>
环境变量
<br />  shell中预设的环境变量都是大写的，比如PATH,HOME,LOGNAME。使用<code>env</code>可以列出系统预设的全部环境变量。
<br />  常见的环境变量：

<ul>
<li>
PATH 决定shell到哪些目录下寻找命令和可执行文件

<li>
HOME 用户的主目录

<li>
HISESIZE 历史记录数

<li>
LOGNAME 当前用户的登录名

<li>
HOSTNAME 主机的名称

<li>
SHELL 用户shell类型

<li>
LANG 与语言相关的环境变量

<li>
MAIL 当前用户存放邮件的目录

<li>
PWD 当前目录

</ul>
</ul>

<ul>
<li>
自定义变量
<br />  自定义的变量只能在当前的shell中使用，要想让自定义的变量一直生效，就要将变量的定义写到配置文件中。

<ol>
<li>
使系统内所有用户都能使用该自定义变量
<br />    在<code>/etc/profile</code>文件最末尾加入，例如加入<code>export myname=waikeungshen</code>，然后运行<code>source /etc/profile</code>就可以立即生效了。

<li>
只让当前用户使用该自定义变量
<br />    在当前用户的主目录下的<code>bashrc</code>文件末尾加入<code>export myname=waikeungshen</code>,然后运行<code>source .bashrc</code>就可以立即生效了。

</ol>
</ul>
  
<ul>
<li>
自定义变量的规则：

<ol>
<li>
设定变量的格式：<code>a=b</code>,其中<code>a</code>为变量名，<code>b</code>为变量的内容，等号两边不能有空格。

<li>
变量名只能由英文，数字，下划线组成，而且不能以数字开头。

<li>
当变量内容中有特殊字符时（如空格），需要加上单引号，如<code>myname='waikeung shen'</code>。若变量本身就带有单引号，那就需要用双引号。

<li>
如果变量需要用到其他命令的运行结果，则需要用反引号(`)。反引号中的命令会先执行。

<li>
变量内容可以累加其他变量的内容,需要加双引号。如<code>myname="\(LOGNAME"shen</code>,若用的是单引号<code>myname='\)LOGNAME'shen</code>，变量的值会变为<code>$LOGNAMEshen</code>。

<li>
单引号与双引号的区别在于：用双引号时不会取消掉里面出现的特殊字符的本身作用 (这里的$),而使用单引号则里面的特殊字符全部失去它本身的作用。

</ol>
</ul>

<p>
在当前shell中运行bash指令后，会进入一个新的shell，这个shell就是原来shell的子shell，可以用<code>pstree</code>命令查看，<code>pstree</code>会打印出系统的进行树。
</p>

<p>
若在父shell中定义的变量要在子shell中运行，就需要用<code>export</code>声明一下。
</p>

<p>
要取消某个变量，只需要用<code>unset</code>命令就可以了。如<code>unset myname</code>。
</p>

<ul>
<li>
系统环境变量与用户环境变量的文件

</ul>

<ul>
<li>
/etc/profile :这个文件预设了几个重要的变量,例如PATH, USER, LOGNAME, MAIL, INPUTRC, HOSTNAME。

<li>
/etc/bashrc :这个文件主要预设umask以及PS1。

<li>
.bash_profile :定义了用户的个人化路径与环境变量的文件名称。每个用户都可使用该文件输入专用于自己使用的 shell信息,当用户登录时,该文件仅仅执行一次。HISTSIZE, umas等等。

<li>
.bashrc :该文件包含专用于你的shell的bash信息,当登录时以及每次打开新的shell时,该该文件被读取。例如你可以将用户自定义的alias或者自定义变量写到这个文件中。

<li>
.bash_history :记录命令历史用的。

<li>
.bash_logout :当退出shell时,会执行该文件。可以把一些清理的工作放到这个文件中。

</ul>

<h3 id="toc_1.1.2">Shell中的特殊符号</h3>

<ol>
<li>
*: 代表零或多个字符

<li>
?: 代表任意一个字符

<li>
#: 注释

<li>
\: 转义字符

<li>
|: 管道

<li>
$: 变量声明

</ol>

<h3 id="toc_1.1.3">基本命令</h3>

<ul>
<li>
grep: 过滤一个或多个字符

<li>
cut: 截取某一段

<li>
sort: 用于排序

<li>
wc :统计文档的行数、字符数、词数

<li>
uniq :去重复的行

<li>
tee: 类似重定向，但在写入文件的同时还显示在屏幕上

<li>
tr :替换字符,常用来处理文档中出现的特殊符号

<li>
split :切割文档

<li>
; :分号。平时我们都是在一行中敲一个命令,然后回车就运行了,那么想在一行中运行两个或两个以上的命令如何呢?则需要在命令之间加一个”;”了。

<li>
~ :用户的家目录,如果是root则是 /root ,普通用户则是 /home/username

<li>
&amp; :如果想把一条命令放到后台执行的话,则需要加上这个符号。通常用于命令运行时间非常长的情况。

<li>
&gt;, &gt;&gt;, 2&gt;, 2&gt;&gt; :前面讲过重定向符号&gt; 以及&gt;&gt; 分别表示取代和追加的意思,然后还有两个符号就是这里的2&gt; 和 2&gt;&gt; 分别表示错误重定向和错误追加重定向,当我们运行一个命令报错时,报错信息会输出到当前的屏幕,如果想 重定向到一个文本里,则要用2&gt;或者2&gt;&gt;。

<li>
[  ] :中括号,中间为字符组合,代表中间字符中的任意一个

<li>
&amp;&amp;和||

</ul>

<p>
write date: 2013-12-18
<hr />
</p>

<h2 id="toc_1.2">Shell 脚本基础</h2>
<p>
这里是一些shell脚本的基础知识,感觉上有点像是在讲些枯燥的语法知识。
</p>
<h3 id="toc_1.2.1">编写基本的脚本</h3>

<pre class="brush:bash">
#!/bin/bash

echo "Hello World!"
</pre>

<p>
<code>echo</code>加上参数<code>-n</code>显示语句不换行。
</p>

<h4 id="toc_1.2.1.1">环境变量与用户变量</h4>
<p>
关于使用变量，参考上文。
</p>

<h4 id="toc_1.2.1.2">数学运算</h4>
<p>
<code>expr</code>命令运行在命令行上处理数学表达式，缺点就是不能处理浮点数。处理浮点运算就用内建bash的计算器，bc。
</p>

<ul>
<li>
expr命令
<br />  expr能够识别一些不同的数字和字符串操作符。

</ul>

<ul>
<li>
bc
<br />  用内建的scale变量设定想要的小数后的位数,默认是0。

</ul>

<p>
在bash中，在将一个数学运算结果赋给某个变量时，可以用美元符和方括号（$[ operation ]）将数学表达式圈起来。用方括号来执行shell数学运算比用expr命令方便很多。
</p>

<h4 id="toc_1.2.1.3">退出脚本</h4>
<p>
<code>exit 0</code>
</p>

<p>
状态码及描述
</p>
<ul>
<li>
<code>0</code> 命令成功结束

<li>
<code>1</code> 通用未知错误

<li>
<code>2</code> 误用shell命令

<li>
<code>126</code> 命令不可执行

<li>
<code>127</code> 没有找到命令

<li>
<code>128</code> 无效退出参数

<li>
<code>128+x</code> Linux信号x的严重错误

<li>
<code>130</code> 命令通过Ctrl+C终止

<li>
<code>255</code> 退出状态码越界

</ul>

<h3 id="toc_1.2.2">结构化命令</h3>

<h4 id="toc_1.2.2.1">if-then</h4>
<pre class="brush:bash">
if command
then
    commands
fi
</pre>
<p>
bash shell 的if语句会运行if后面的command命令，如果该命令的退出码为<code>0</code>(该命令运行成功)，位于<code>then</code>部分的命令就会被执行。
</p>

<p>
if-then-else语句
</p>
<pre class="brush:bash">
if command
then
    commands
else
    commands
fi
</pre>
<p>
嵌套if
</p>
<pre class="brush:bash">
if command1
then
    command set 1
elif command2
then
    command set 2
elif command3
then
    command set 3
elif command4
then
    command set 4
fi
</pre>
<h4 id="toc_1.2.2.2">test</h4>
<p>
如果<code>test</code>命令中的列出来的条件成立，<code>test</code>就会返回退出状态码0
</p>
<pre class="brush:bash">
if test condition
then
    commands
fi
</pre>
<pre class="brush:bash">
if [ condition ]
then
    commands
fi
</pre>
<h4 id="toc_1.2.2.3">for</h4>

<h4 id="toc_1.2.2.4">while</h4>

<h4 id="toc_1.2.2.5">until</h4>

<h4 id="toc_1.2.2.6">break,continue</h4>

<h3 id="toc_1.2.3">输入输出</h3>
<h4 id="toc_1.2.3.1">重定向输入输出</h4>
<p>
有的时候要保存某个命令的输出，而不是显示到屏幕上;有的时候某个命令的输入需要从文件中输入。
</p>

<ul>
<li>
输出重定向
<br />  将命令的输出发送到一个文件中去，用<code>&gt;</code>。
<br />  <code>command &gt; outputfile</code>

<li>
输入重定向
<br />  将文件的内容重定向到命令，用<code>&lt;</code>。
<br />  <code>command &lt; inputfile</code>

</ul>

<p>
<strong>输出重定向中，若输出文件存在，重定向操作会用新的文件覆盖原有的文件。</strong>
</p>

<h4 id="toc_1.2.3.2">管道</h4>
<p>
一个命令的输出是另一个命令的输入。
</p>

<h3 id="toc_1.2.4">函数</h3>

<h3 id="toc_1.2.5">控制脚本</h3>


<h2 id="toc_1.3">一些需要注意的地方</h2>
<ul>
<li>
变量定义，括号左右没有空格。比如<code>num=1</code>,而不是<code>num = 1</code>。write time:2014-01-04 09:48 AM

</ul>

</div>
<div id="footer">
2013-2014 Creat by vimwiki
</div>
</body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47865607-1', 'waikeungshen.info');
  ga('send', 'pageview');

</script>
</html>
